<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Entrega de Solicitudes - CompuServices</title>
  <style>
    body { font-family:'Segoe UI', sans-serif; background:#f4f4f4; margin:0; padding:0; }
    header { text-align:center; padding:15px; }
    header img { height:60px; }
    h1 { margin:10px 0; color:#002b5c; font-weight:600; }
    .container { width:90%; margin:20px auto; background:white; padding:25px; border-radius:10px;
                 box-shadow:0px 2px 6px rgba(0,0,0,0.12); display:flex; gap:40px; align-items:flex-start; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; font-size:14px; }
    th { background:#002b5c; color:white; }
    .boton-entregar { background:#007bff; color:white; padding:6px 12px; border:none; border-radius:4px;
                      cursor:pointer; font-size:13px; font-weight:bold; }
    .boton-entregar:hover { background:#0056b3; }
    .manual { flex:1; background:#eef2f7; padding:15px; border-left:4px solid #002b5c; font-size:13px; border-radius:6px; }
    .manual h2 { margin-top:0; font-size:14px; color:#002b5c; }
    .manual ul { padding-left:18px; }
    .manual li { margin-bottom:8px; }
    .manual a { color:#002b5c; font-weight:bold; text-decoration:none; }
    footer { text-align:center; margin-top:25px; font-size:13px; color:#555; }
    #pantallaCarga { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
                     background-color:rgba(0,0,0,0.55); z-index:9999; text-align:center; padding-top:20%;
                     color:white; font-size:22px; font-weight:bold; }
    .spinner { margin-top:20px; border:6px solid #f3f3f3; border-top:6px solid #ffffff; border-radius:50%;
               width:45px; height:45px; animation:spin 1s linear infinite; display:inline-block; }
    @keyframes spin { 0% { transform:rotate(0deg);} 100% { transform:rotate(360deg);} }
  </style>
</head>
<body>

<header>
  <img src="https://www.compuservices.com.mx/wpimages/compu-services.png" alt="Logo CompuServices">
  <h1>Entrega de Solicitudes</h1>
</header>

<div class="container">
  <!-- Tabla de solicitudes -->
  <div style="flex:2;">
    <table id="tablaSolicitudes">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Ingeniero</th>
          <th>Lote</th>
          <th>Clave</th>
          <th>Cantidad</th>
          <th>Estado</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody>
        <!-- Aqu√≠ se llenar√°n las solicitudes autorizadas -->
      </tbody>
    </table>
  </div>

  <!-- Manual de uso -->
  <div class="manual">
    <h2>Manual de Entrega</h2>
    <ul>
      <li>üìã Revise las solicitudes que ya fueron <b>autorizadas</b>.</li>
      <li>üëÄ Verifique que los datos (ingeniero, lote, clave, cantidad) coincidan con lo solicitado.</li>
      <li>üì¶ Para marcar como entregada, haga clic en el bot√≥n <b>Entregar</b> de la fila correspondiente.</li>
      <li>‚è≥ Espere el mensaje de confirmaci√≥n. El sistema actualizar√° autom√°ticamente el estado a <b>Entregado</b>.</li>
      <li>üîÑ La tabla se refrescar√° mostrando las solicitudes restantes por entregar.</li>
    </ul>
    üìë Consulte el <a href="https://raw.githubusercontent.com/Fernandoamm0/consumibles/main/catalogoconsumibles.pdf" target="_blank">Cat√°logo de Consumibles</a> si necesita validar claves.
  </div>
</div>

<footer>
  Creado por Fernando Mora ¬© 2025 - Sistema de solicitud de consumibles V1.0 - CompuServices S. A. de C. V.
</footer>

<div id="pantallaCarga">
  Procesando entrega... ‚è≥
  <div class="spinner"></div>
</div>

<script>
// URL de tu WebApp
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzfISsvFOxT4LiAZLsGwIwDaCCqPjM86-0A9Dcc1h3Pml9m4Li5RuT6kM8JQA0ZKWjC/exec";

// Renderizar tabla con solicitudes autorizadas
function cargarSolicitudes() {
  fetch(SCRIPT_URL + "?estado=Autorizado")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#tablaSolicitudes tbody");
      tbody.innerHTML = "";
      data.forEach(s => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${s.fecha}</td>
          <td>${s.ingeniero}</td>
          <td>${s.lote}</td>
          <td>${s.clave}</td>
          <td>${s.cantidad}</td>
          <td>${s.estado}</td>
          <td><button class="boton-entregar" onclick="entregar(${s.fila})">Entregar</button></td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      alert("‚ùå Error al cargar solicitudes: " + err);
    });
}

// Marcar como entregada
function entregar(filaId) {
  document.getElementById("pantallaCarga").style.display = "block";
  fetch(SCRIPT_URL + "?filaId=" + filaId + "&nuevoEstado=Entregado")
    .then(res => res.text())
    .then(text => {
      alert("üì¶ Solicitud entregada (fila " + filaId + ")");
      document.getElementById("pantallaCarga").style.display = "none";
      cargarSolicitudes(); // refrescar tabla
    })
    .catch(err => {
      alert("‚ùå Error: " + err);
      document.getElementById("pantallaCarga").style.display = "none";
    });
}

// Inicializar
cargarSolicitudes();
</script>

</body>
</html>
